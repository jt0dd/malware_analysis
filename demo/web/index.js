const CPU = require("./classes/CPU.js");
const Executable = require("./classes/Executable.js");
const bufferToBin = require("./funcs/bufferToBin");
const bufferToHex = require("./funcs/bufferToHex");
//const result = ALU.add(registers.rax, registers.ebx, "unsigned");
//registers.rcx.write(result, "unsigned");

(async () => {
  const cpu = new CPU();
  const executable = new Executable("../data/written/fasm/1.exe");
  await executable.load();
  cpu.mount(executable)
  console.log("executable", executable);
  console.log("executable.textSegments", executable.textSegment);  
  cpu.memory.write(0, Uint8Array.from([30]))
  console.log('first byte', bufferToHex(cpu.memory.read(0, 1)))
  cpu.memory.writeBit(0, 4, 0)
  cpu.memory.writeBit(0, 5, 0)
  cpu.memory.writeBit(0, 6, 1)
  cpu.memory.writeBit(0, 7, 0)
  console.log('first byte (REX prefixed)', bufferToHex(cpu.memory.read(0, 1)))
  cpu.fetch()
})();
